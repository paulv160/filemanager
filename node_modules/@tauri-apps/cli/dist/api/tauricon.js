import{_ as e,a as r}from"../tslib.es6-753a81cf.js";import*as t from"fs-extra";import n from"imagemin";import i from"imagemin-optipng";import s from"imagemin-zopfli";import o from"is-png";import a from"path";import*as c from"png2icons";import u from"read-chunk";import f from"sharp";import{t as l,a as p}from"../app-paths-46150e8b.js";import{l as d}from"../logger-27e93e7d.js";import h from"chalk";import{createRequire as g}from"module";import"fs";import"ms";var b={background_color:"#000074",theme_color:"#02aa9b",sharp:"kernel: sharp.kernel.lanczos3",minify:{batch:!1,overwrite:!0,available:["optipng","zopfli"],type:"optipng",optipngOptions:{optimizationLevel:4,paletteReduction:!0},zopfliOptions:{transparent:!0,more:!0}},splash_type:"generate",tauri:{linux:{folder:".",prefix:"",infix:!0,suffix:".png",sizes:[32,128]},linux_2x:{folder:".",prefix:"128x128@2x",infix:!1,suffix:".png",sizes:[256]},defaults:{folder:".",prefix:"icon",infix:!1,suffix:".png",sizes:[512]},appx_logo:{folder:".",prefix:"StoreLogo",infix:!1,suffix:".png",sizes:[50]},appx_square:{folder:".",prefix:"Square",infix:!0,suffix:"Logo.png",sizes:[30,44,71,89,107,142,150,284,310]}}},m=t.default,v=m.access,x=m.ensureDir,w=m.ensureFileSync,y=m.writeFileSync,k=g(import.meta.url)("../../package.json").version,z=d("app:spawn"),I=d("app:spawn",h.red),R=!1,S=null,_=function(t){return e(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,v(t)];case 1:return e.sent(),[2,!0];case 2:return e.sent(),[2,!1];case 3:return[2]}}))}))},O=function(t){return e(void 0,void 0,void 0,(function(){var e,n;return r(this,(function(r){switch(r.label){case 0:return!1===R?[3,1]:[2,R];case 1:return[4,_(t)];case 2:return r.sent()?[3,3]:(R=!1,S&&clearInterval(S),I("[ERROR] Source image for tauricon not found"),process.exit(1),[3,8]);case 3:return[4,u(t,0,8)];case 4:return e=r.sent(),o(e)?[4,(R=f(t)).metadata()]:[3,7];case 5:return(n=r.sent()).hasAlpha&&4===n.channels||(S&&clearInterval(S),I("[ERROR] Source png for tauricon is not transparent"),process.exit(1)),[4,R.stats()];case 6:return r.sent().isOpaque&&(S&&clearInterval(S),I("[ERROR] Source png for tauricon could not be detected as transparent"),process.exit(1)),[2,R];case 7:R=!1,S&&clearInterval(S),I("[ERROR] Source image for tauricon is not a png"),process.exit(1),r.label=8;case 8:return[2]}}))}))},j=function(e){var r=[];for(var t in e){var n=e[String(t)];n.folder&&r.push(n.folder)}return r=r.sort().filter((function(e,r,t){return!r||e!==t[r-1]}))},E=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,r,t,n){return r+r+t+t+n+n}));var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:void 0},B=function(t,n){return e(void 0,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return void 0===n?[3,2]:[4,x(n)];case 1:e.sent(),e.label=2;case 2:return[4,O(t)];case 3:return[2,e.sent()]}}))}))},C=function(e){process.stdout.write("  "+e+"                       \r")},F={validate:function(t,n){return e(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,B(t,n)];case 1:return e.sent(),[2,"object"==typeof R]}}))}))},version:function(){return k},make:function(t,n,i,s){return void 0===n&&(n=a.resolve(l,"icons")),e(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return t||(t=a.resolve(p,"app-icon.png")),S="CI"in process.env||process.argv.some((function(e){return"--ci"===e}))?null:setInterval((function(){process.stdout.write("/ \r"),setTimeout((function(){process.stdout.write("- \r"),setTimeout((function(){process.stdout.write("\\ \r"),setTimeout((function(){process.stdout.write("| \r")}),100)}),100)}),100)}),500),s=s||b.tauri,C('Building Tauri icns and ico from "'+t+'"'),[4,this.validate(t,n)];case 1:return e.sent(),[4,this.icns(t,n,s,i)];case 2:return e.sent(),C("Building Tauri png icons"),[4,this.build(t,n,s)];case 3:return e.sent(),i?(C("Minifying assets with "+i),[4,this.minify(n,s,i,"batch")]):[3,5];case 4:return e.sent(),[3,6];case 5:z("no minify strategy"),e.label=6;case 6:return C("Tauricon Finished"),S&&clearInterval(S),[2,!0]}}))}))},build:function(t,n,i){return e(this,void 0,void 0,(function(){var s,o,c,u,l,p,d,h,g,b,m,v,w,y,k,z,R,S;return r(this,(function(_){switch(_.label){case 0:return[4,this.validate(t,n)];case 1:for(l in _.sent(),s=f(t),o=function(t){return e(this,void 0,void 0,(function(){var e,n,o;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=s.resize(t[1],t[1]),t[2]&&(n=E(i.background_color)||{r:void 0,g:void 0,b:void 0},e.flatten({background:{r:n.r,g:n.g,b:n.b,alpha:1}})),e.png(),[4,e.toFile(t[0])];case 1:return r.sent(),[3,3];case 2:return o=r.sent(),I(o),[3,3];case 3:return[2]}}))}))},u=j(i))p=u[Number(l)],x(""+n+a.sep+p);for(h in d=[],i)d.push(h);g=0,_.label=2;case 2:if(!(g<d.length))return[3,7];for(w in b=d[g],m=i[String(b)],v=[],m.sizes)v.push(w);y=0,_.label=3;case 3:return y<v.length?(k=v[y],z=m.sizes[String(k)],m.splash?[3,5]:(R=n+"/"+m.folder,c=!0===m.infix?""+R+a.sep+m.prefix+z+"x"+z+m.suffix:""+R+a.sep+m.prefix+m.suffix,S=[c,z,m.background],[4,o(S)])):[3,6];case 4:_.sent(),_.label=5;case 5:return y++,[3,3];case 6:return g++,[3,2];case 7:return[2]}}))}))},splash:function(t,n,i,s){return e(this,void 0,void 0,(function(){var e,o,c,u,l,p,d,h,g,b,m,v,w,y,k,z,I;return r(this,(function(r){switch(r.label){case 0:return o=!1,c=E(s.background_color)||{r:void 0,g:void 0,b:void 0},n===t&&(o=!0),o||"generate"===s.splashscreen_type?[4,this.validate(t,i)]:[3,2];case 1:return r.sent(),R||process.exit(1),(u=f(t)).extend({top:726,bottom:726,left:726,right:726,background:{r:c.r,g:c.g,b:c.b,alpha:1}}).flatten({background:{r:c.r,g:c.g,b:c.b,alpha:1}}),[3,3];case 2:if("overlay"===s.splashscreen_type)u=f(n).flatten({background:{r:c.r,g:c.g,b:c.b,alpha:1}}).composite([{input:t}]);else{if("pure"!==s.splashscreen_type)throw new Error("unknown options.splashscreen_type: "+s.splashscreen_type);u=f(n).flatten({background:{r:c.r,g:c.g,b:c.b,alpha:1}})}r.label=3;case 3:return[4,u.toBuffer()];case 4:for(d in l=r.sent(),p=[],s)p.push(d);h=0,r.label=5;case 5:if(!(h<p.length))return[3,11];for(v in g=p[h],b=s[String(g)],m=[],b.sizes)m.push(v);w=0,r.label=6;case 6:return w<m.length?(y=m[w],k=b.sizes[String(y)],b.splash?(z=""+i+a.sep+b.folder,[4,x(z)]):[3,9]):[3,10];case 7:return r.sent(),e=!0===b.infix?""+z+a.sep+b.prefix+k+"x"+k+b.suffix:""+z+a.sep+b.prefix+b.suffix,I=[e,k],[4,f(l).resize(I[1][0],I[1][1]).toFile(I[0])];case 8:r.sent(),r.label=9;case 9:return w++,[3,6];case 10:return h++,[3,5];case 11:return[2]}}))}))},minify:function(t,o,c,u){return e(this,void 0,void 0,(function(){var f,l,p,d,h,g,m,v,x,w=this;return r(this,(function(y){switch(y.label){case 0:switch((l=b.minify).available.find((function(e){return e===c}))||(c=l.type),c){case"optipng":f=i(l.optipngOptions);break;case"zopfli":f=s(l.zopfliOptions);break;default:throw new Error("unknown strategy"+c)}switch(p=function(t,i){return e(w,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,n([t[0]],{destination:t[1],plugins:[i]}).catch((function(e){I(e)}))];case 1:return e.sent(),[2]}}))}))},u){case"singlefile":return[3,1];case"batch":return[3,3]}return[3,8];case 1:return[4,p([t,a.dirname(t)],f)];case 2:return y.sent(),[3,9];case 3:for(g in d=j(o),h=[],d)h.push(g);m=0,y.label=4;case 4:return m<h.length?(v=h[m],x=d[Number(v)],z("batch minify:"+String(x)),[4,p([""+t+a.sep+x+a.sep+"*.png",""+t+a.sep+x],f)]):[3,7];case 5:y.sent(),y.label=6;case 6:return m++,[3,4];case 7:return[3,9];case 8:I("[ERROR] Minify mode must be one of [ singlefile | batch]"),process.exit(1),y.label=9;case 9:return[2,"minified"]}}))}))},icns:function(t,n,i,s){return e(this,void 0,void 0,(function(){var e,i,s,o;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),R||process.exit(1),[4,this.validate(t,n)];case 1:return r.sent(),[4,f(t).toBuffer()];case 2:if(e=r.sent(),null===(i=c.createICNS(e,c.BICUBIC,0)))throw new Error("Failed to create icon.icns");if(w(a.join(n,"/icon.icns")),y(a.join(n,"/icon.icns"),i),null===(s=c.createICO(e,c.BICUBIC,0,!0)))throw new Error("Failed to create icon.ico");return w(a.join(n,"/icon.ico")),y(a.join(n,"/icon.ico"),s),[3,4];case 3:throw o=r.sent(),console.error(o),o;case 4:return[2]}}))}))}};export{F as default};
